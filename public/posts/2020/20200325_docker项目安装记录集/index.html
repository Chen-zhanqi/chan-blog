<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Docker项目安装记录集 - Chan-技术与生活</title><meta name="Description" content="微服务容器"><meta property="og:url" content="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/">
  <meta property="og:site_name" content="Chan-技术与生活">
  <meta property="og:title" content="Docker项目安装记录集">
  <meta property="og:description" content="微服务容器">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-03-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-03-25T00:00:00+00:00">
    <meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker项目安装记录集">
<meta name="twitter:description" content="微服务容器">
<meta name="application-name" content="Chan">
<meta name="apple-mobile-web-app-title" content="Chan"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
<link rel="icon" href="https://qn.chenzqi.cn/blog/img/logo.png"><link rel="apple-touch-icon" sizes="180x180" href="https://qn.chenzqi.cn/blog/img/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="Chan的博客">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" /><link rel="prev" href="https://chenzqi.cn/posts/2019/20190620_xxx%E8%80%83%E7%A0%94%E6%9F%A5%E8%AF%A2%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%88%AC%E8%99%AB/" /><link rel="next" href="https://chenzqi.cn/posts/2020/20200401_macos%E5%AE%89%E8%A3%85homebrew%E9%97%AE%E9%A2%98/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Docker项目安装记录集",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/chenzqi.cn\/posts\/2020\/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86\/"
        },"genre": "posts","keywords": "Docker","wordcount":  1615 ,
        "url": "https:\/\/chenzqi.cn\/posts\/2020\/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86\/","datePublished": "2020-03-25T00:00:00+00:00","dateModified": "2020-03-25T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chan"
            },"description": "微服务容器"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chan-技术与生活"><span class="header-title-pre"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i></span>Chan</a>
        </div>
        <div class="menu">
            <div class="menu-inner">
                    <div class="dropdown">
                        <a href="/posts/" class="menu-item menu-more dropbtn" title="" ><i class='fas fa-fw fa-archive'></i> 归档 
                        </a>
                        <div class="menu-more-content dropdown-content"><a href="/categories/" title="" ><i class='fas fa-fw fa-th'></i> 分类 </a><a href="/tags/" title="" ><i class='fas fa-fw fa-tag'></i> 标签 </a></div>
                    </div>
                <a class="menu-item" href="/friends/"><i class='fas fa-fw fa-fan fa-spin'></i> 友链 
                    </a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> 搜索 
                    </a><a class="menu-item" href="/about/photo/"><i class='fas fa-fw fa-at'></i> 相册 
                    </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chan-技术与生活"><span class="header-title-pre"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i></span>Chan</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class='fas fa-fw fa-archive'></i>归档</a><a class="menu-item" href="/friends/" title=""><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a class="menu-item" href="/search/" title=""><i class='fas fa-fw fa-search'></i>搜索</a><a class="menu-item" href="/about/photo/" title=""><i class='fas fa-fw fa-at'></i>相册</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container">
                    <div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Docker项目安装记录集</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chan</a></span>&nbsp;<span class="post-category">included in <a href="/categories/2020/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>2020</a>&nbsp;<a href="/categories/%E6%8A%80%E6%9C%AF/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>技术</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2020-03-25">2020-03-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1615 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#部署java项目">部署java项目</a></li>
    <li><a href="#软件安装">软件安装</a>
      <ul>
        <li><a href="#安装mysql">安装Mysql</a></li>
        <li><a href="#安装redis">安装Redis</a></li>
        <li><a href="#安装nginx">安装nginx</a></li>
        <li><a href="#安装nacos">安装nacos</a></li>
        <li><a href="#安装elasticsearch">安装elasticSearch</a></li>
        <li><a href="#安装kibana">安装Kibana</a></li>
        <li><a href="#安装oracle11g">安装Oracle11g</a></li>
      </ul>
    </li>
    <li><a href="#出现数据库不能连接错误">出现数据库不能连接错误</a></li>
    <li><a href="#docker访问宿主机">Docker访问宿主机</a></li>
    <li><a href="#docker命令自动补全">Docker命令自动补全</a></li>
    <li><a href="#设置自启">设置自启</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>:::tip
使用Dockerfile部署项目,docker安装不同软件
:::</p>
<!-- more -->
<h2 id="部署java项目">部署java项目</h2>
<p>创建<strong>Dockerfile</strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf"># 基础镜像是docker仓库的java:8（也就是jdk8的意思）
FROM java:8
#  作者签名
MAINTAINER xiaoxiang
#  简化 jar 的名字路径 （左边是服务器中jar包的路径，因为当前文件是和jar包同级，所以直接写名字即可，右边是镜像中要存放jar包的路径）
COPY test.jar /test.jar
# 设置时间
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#39;Asia/Shanghai&#39; &gt;/etc/timezone
#  执行 java -jar 命令 （CMD：在启动容器时才执行此行。RUN：构建镜像时就此行，后面的jar包路径就是上面要设置的jar包路径）
CMD java -jar /test.jar
#  设置对外端口为 8080
EXPOSE 8080
</code></pre><p><strong>创建镜像</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 后面有个点，指定路径为当前路径的Dockerfile文件</span>
</span></span><span class="line"><span class="cl">docker build -t <span class="nb">test</span> .
</span></span></code></pre></div><p><strong>运行jar包</strong></p>
<ul>
<li>-d代表<strong>后台运行</strong></li>
<li>-p 8082:8082 端口映射，后一个8082是镜像的端口</li>
<li>-v 代表挂载一个宿主机目录到容器目录中，<strong>第一个是宿主机目录，第二个是容器目录</strong></li>
<li>第一个test/java代表是给<strong>容器的名字</strong></li>
<li>第二个test是上面创建<strong>镜像的名字</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 8080:8080 -v /opt/java:/opt/java --name test/java <span class="nb">test</span>
</span></span></code></pre></div><p><strong>查看容器</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps -a
</span></span></code></pre></div><h2 id="软件安装">软件安装</h2>
<h3 id="安装mysql">安装Mysql</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/data/mysql/data
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/data/mysql/conf.d
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -di -p 3307:3306 -v /opt/data/mysql/conf.d:/etc/mysql/conf.d -v /opt/data/mysql/data:/var/lib/mysql -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>密码 --name mysql mysql
</span></span></code></pre></div><h3 id="安装redis">安装Redis</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/data/redis/data
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/data/redis/conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /opt/data/redis/conf/redis.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 6379:6379 --name redis  -v /opt/data/redis/redis.conf:/etc/redis/redis.conf  -v /opt/data/redis/data:/data redis redis-server /etc/redis/redis.conf --requirepass <span class="s2">&#34;密码&#34;</span>  --appendonly yes
</span></span></code></pre></div><p><strong>redis.conf</strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">protected-mode yes
port 6379
tcp-backlog 511
timeout 0
daemonize yes
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile /var/log/redis/redis.log
databases 16
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /var/lib/redis
slave-serve-stale-data yes
slave-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
slave-priority 100
requirepass 密码
appendonly no
appendfilename &#34;appendonly.aof&#34;
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
lua-time-limit 5000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events &#34;&#34;
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
aof-rewrite-incremental-fsync yes
</code></pre><h3 id="安装nginx">安装nginx</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/data/nginx/<span class="o">{</span>conf,html,logs<span class="o">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /usr/nginx/conf/nginx.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name nginx -d -p 80:80 -p 443:443 -v /opt/data/nginx/html:/usr/share/nginx/html:ro -v /opt/data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro  -v /opt/data/nginx/conf.d:/etc/nginx/conf.d:ro -v /opt/data/nginx/logs:/var/log/nginx nginx
</span></span></code></pre></div><p><strong>nginx.conf</strong></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;
include /usr/share/nginx/modules/*.conf;
events {
    worker_connections 1024;
}
http {
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;
                      &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;
                      &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;

    access_log  /var/log/nginx/access.log  main;
    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;


    server {
        listen       80 default_server;
        listen       [::]:80 default_server;
        server_name  _;
        root         /usr/share/nginx/html;

        include /etc/nginx/default.d/*.conf;

        location / {
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }
# Settings for a TLS enabled server.
#
#    server {
#        listen       443 ssl http2 default_server;
#        listen       [::]:443 ssl http2 default_server;
#        server_name  _;
#        root         /usr/share/nginx/html;
#
#        ssl_certificate &#34;/etc/pki/nginx/server.crt&#34;;
#        ssl_certificate_key &#34;/etc/pki/nginx/private/server.key&#34;;
#        ssl_session_cache shared:SSL:1m;
#        ssl_session_timeout  10m;
#        ssl_ciphers HIGH:!aNULL:!MD5;
#        ssl_prefer_server_ciphers on;
#
#        # Load configuration files for the default server block.
#        include /etc/nginx/default.d/*.conf;
#
#        location / {
#        }
#
#        error_page 404 /404.html;
#            location = /40x.html {
#        }
#
#        error_page 500 502 503 504 /50x.html;
#            location = /50x.html {
#        }
#    }

}
</code></pre><h3 id="安装nacos">安装nacos</h3>
<p><strong>使用挂载文件的方式</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p /opt/nacos/logs
</span></span><span class="line"><span class="cl">mkdir -p /opt/nacos/conf
</span></span><span class="line"><span class="cl">touch  /opt/nacos/conf/application.properties
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d --name nacos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-v /opt/nacos/conf/application.properties:/home/nacos/conf/application.properties <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-v /opt/nacos/conf/logs:/home/nacos/conf/logs <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-p 8848:8848 nacos/nacos-server
</span></span></code></pre></div><p><strong>application.properties</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">server.servlet.contextPath</span><span class="o">=</span><span class="s">/nacos</span>
</span></span><span class="line"><span class="cl"><span class="na">server.port</span><span class="o">=</span><span class="s">8848</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.naming.empty-service.auto-clean</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.naming.empty-service.clean.initial-delay-ms</span><span class="o">=</span><span class="s">60000</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.naming.empty-service.clean.period-time-ms</span><span class="o">=</span><span class="s">20000</span>
</span></span><span class="line"><span class="cl"><span class="na">management.metrics.export.elastic.enabled</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">management.metrics.export.influx.enabled</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">server.tomcat.accesslog.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">server.tomcat.accesslog.pattern</span><span class="o">=</span><span class="s">%h %l %u %t &#34;%r&#34; %s %b %D %{User-Agent}i</span>
</span></span><span class="line"><span class="cl"><span class="na">server.tomcat.basedir</span><span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.security.ignore.urls</span><span class="o">=</span><span class="s">/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.core.auth.system.type</span><span class="o">=</span><span class="s">nacos</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.core.auth.enabled</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.core.auth.default.token.expire.seconds</span><span class="o">=</span><span class="s">18000</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.core.auth.default.token.secret.key</span><span class="o">=</span><span class="s">SecretKey012345678901234567890123456789012345678901234567890123456789</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.core.auth.caching.enabled</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">nacos.istio.mcp.server.enabled</span><span class="o">=</span><span class="s">false</span>
</span></span><span class="line"><span class="cl"><span class="na">spring.datasource.platform</span><span class="o">=</span><span class="s">mysql</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">db.num</span><span class="o">=</span><span class="s">1</span>
</span></span><span class="line"><span class="cl"><span class="na">db.url.0</span><span class="o">=</span><span class="s">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span>
</span></span><span class="line"><span class="cl"><span class="na">db.user</span><span class="o">=</span><span class="s">root</span>
</span></span><span class="line"><span class="cl"><span class="na">db.password</span><span class="o">=</span><span class="s">123456</span>
</span></span></code></pre></div><h3 id="安装elasticsearch">安装elasticSearch</h3>
<p><strong>安装</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d --name es -p 9200:9200 -p 9300:9300 -e <span class="s2">&#34;discovery.type=single-node&#34;</span> docker.elastic.co/elasticsearch/elasticsearch:7.6.2
</span></span></code></pre></div><p><strong>配置跨域和密码</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 进入容器</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it es /bin/bash
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 编辑文件</span>
</span></span><span class="line"><span class="cl">vi config/elasticsearch.yml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 名称，保证唯一</span>
</span></span><span class="line"><span class="cl">cluster.name: es-1
</span></span><span class="line"><span class="cl"><span class="c1"># 为本机ip地址,docker中为0.0.0.0</span>
</span></span><span class="line"><span class="cl">network.host: 0.0.0.0
</span></span><span class="line"><span class="cl"><span class="c1"># 打开跨域，选填</span>
</span></span><span class="line"><span class="cl">http.cors.enabled: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">http.cors.allow-origin: <span class="s2">&#34;*&#34;</span>
</span></span><span class="line"><span class="cl">http.cors.allow-headers: Authorization
</span></span><span class="line"><span class="cl"><span class="c1"># 开启安全认证，选填</span>
</span></span><span class="line"><span class="cl">xpack.security.enabled: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">xpack.security.transport.ssl.enabled: <span class="nb">true</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 重启镜像</span>
</span></span><span class="line"><span class="cl">docker restart es 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 设置密码，进入bin目录</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 需要为4个用户分别设置密码：elastic、kibana、logstash_system、beats_system</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /usr/local/kibana-7.6.2-linux-x86_64/bin <span class="o">&amp;&amp;</span> ./elasticsearch-setup-passwords interactive
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 浏览器查看</span>
</span></span><span class="line"><span class="cl">192.168.0.18:9200
</span></span></code></pre></div><p><strong>安装中文分词</strong>
<a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener noreffer ">GitHub下载</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 下载后解压移动到/usr/share/elasticsearch/plugins，重启</span>
</span></span><span class="line"><span class="cl">docker cp elasticsearch-analysis-ik-7.8.0/ es:/usr/share/elasticsearch/plugins
</span></span><span class="line"><span class="cl">docker restart es
</span></span></code></pre></div><h3 id="安装kibana">安装Kibana</h3>
<p><strong>创建配置文件</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">server.name</span><span class="p">:</span><span class="w"> </span><span class="l">kibana</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">server.host</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># elasticSearch地址</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">elasticsearch.hosts</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&#34;http://127.0.0.1:9200&#34;</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">xpack.monitoring.ui.container.elasticsearch.enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#添加密码数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">elasticsearch.username</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;elastic&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">elasticsearch.password</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xxx&#34;</span><span class="w">
</span></span></span></code></pre></div><p><strong>安装</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d --log-driver json-file --log-opt max-size<span class="o">=</span>100m --log-opt max-file<span class="o">=</span><span class="m">2</span> --name kibana -p 5601:5601 -v /opt/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.4.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 浏览器查看</span>
</span></span><span class="line"><span class="cl">127.0.0.1:5601
</span></span></code></pre></div><h3 id="安装oracle11g">安装Oracle11g</h3>
<p>下载Oracle 11g R2安装包</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 创建目录</span>
</span></span><span class="line"><span class="cl">mkdir -p /opt/oracle/install/database
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解压下载的文件</span>
</span></span><span class="line"><span class="cl">unzip -d linux.x64_11gR2_database_1of2.zip /opt/oracle/install/database
</span></span><span class="line"><span class="cl">unzip -d linux.x64_11gR2_database_2of2.zip /opt/oracle/install/database
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 安装,安装过程很久，可能会卡在终端,可以新开一个终端查看是否安装完成</span>
</span></span><span class="line"><span class="cl">docker run --privileged --name oracle -p 1521:1521 -v /opt/oracle/install/database:/install docker.io/jaspeen/oracle-11g
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 进入容器</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it oracle11g /bin/bash
</span></span><span class="line"><span class="cl"><span class="c1"># 切换到oracle用户</span>
</span></span><span class="line"><span class="cl">su - oracle
</span></span><span class="line"><span class="cl"><span class="c1"># 进入数据库</span>
</span></span><span class="line"><span class="cl">sqlplus / as sysdba
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 创建一个用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 给用户授权
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">grant</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">session</span><span class="p">,</span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="p">,</span><span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="p">,</span><span class="n">unlimited</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">username</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="出现数据库不能连接错误">出现数据库不能连接错误</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/chen-zq/bgimages/raw/master/img/20201112195004.png"
        data-srcset="https://gitee.com/chen-zq/bgimages/raw/master/img/20201112195004.png, https://gitee.com/chen-zq/bgimages/raw/master/img/20201112195004.png 1.5x, https://gitee.com/chen-zq/bgimages/raw/master/img/20201112195004.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/chen-zq/bgimages/raw/master/img/20201112195004.png"
        title="docker出现数据库连接异常" /></p>
<p>拷贝容器中的timezone文件到本地</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 第一个名字是容器和路径，第二个点代表拷贝到当前目录下</span>
</span></span><span class="line"><span class="cl">docker cp test/java:/etc/timezone .
</span></span></code></pre></div><p>修改</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Etc/CST
</span></span></code></pre></div><p>放回原位</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 在文件所在的目录下拷贝到容器的 /etc/下</span>
</span></span><span class="line"><span class="cl">docker cp timezone 容器名称:/etc/
</span></span></code></pre></div><h2 id="docker访问宿主机">Docker访问宿主机</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /etc/firewalld/zones/public.xml
</span></span></code></pre></div><p><strong>添加</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;rule</span> <span class="na">family=</span><span class="s">&#34;ipv4&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;source</span> <span class="na">address=</span><span class="s">&#34;172.17.0.0/16&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;accept</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/rule&gt;</span>
</span></span></code></pre></div><p><strong>重启防火墙</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl restart firewalld
</span></span></code></pre></div><h2 id="docker命令自动补全">Docker命令自动补全</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum install -y bash-completion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /usr/share/bash-completion/bash_completion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /usr/share/bash-completion/completions/docker
</span></span></code></pre></div><h2 id="设置自启">设置自启</h2>
<p>设置自启动</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker update --restart<span class="o">=</span>always 容器id
</span></span></code></pre></div><p>关闭自启动</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker update --restart<span class="o">=</span>no 容器id
</span></span></code></pre></div><p>关闭所有自启动</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker update --restart<span class="o">=</span>no <span class="k">$(</span>docker ps -q<span class="k">)</span>
</span></span></code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-03-25</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" data-title="Docker项目安装记录集" data-hashtags="Docker"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" data-hashtag="Docker"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" data-title="Docker项目安装记录集"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" data-title="Docker项目安装记录集"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://chenzqi.cn/posts/2020/20200325_docker%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95%E9%9B%86/" data-title="Docker项目安装记录集"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/docker/">Docker</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2019/20190620_xxx%E8%80%83%E7%A0%94%E6%9F%A5%E8%AF%A2%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%88%AC%E8%99%AB/" class="prev" rel="prev" title="某考研查询微信小程序爬虫"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>某考研查询微信小程序爬虫</a>
            <a href="/posts/2020/20200401_macos%E5%AE%89%E8%A3%85homebrew%E9%97%AE%E9%A2%98/" class="next" rel="next" title="macOS安装Homebrew问题">macOS安装Homebrew问题<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container">
            
            <div class="footer-line">
                <span id="run-time"></span>
            </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2018 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Chan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a target='_blank' href='http://www.beian.miit.gov.cn/' style='font-weight:500'>豫ICP备2021019462</a></span></div>
        </div>
    </footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="/js/custom.js"></script></body>
</html>
